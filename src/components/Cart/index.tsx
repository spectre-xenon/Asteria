import { useContext, useEffect, useState, type FC } from "react";
import { SideCart } from "./SideCart";
import { useLocation } from "react-router-dom";
import { cartContext } from "@/Root";

const Cart: FC<{ className?: string }> = ({ className }) => {
  const { pathname } = useLocation();
  const [isOpen, setIsOpen] = useState(false);
  const { cartData, cartDispatch } = useContext(cartContext);

  const haveItems = Object.keys(cartData).length > 0 ? true : false;
  const classes = `${className} order-2 md:order-4 hover:cursor-pointer`;

  const handleClick = () => {
    setIsOpen(!isOpen);
  };

  useEffect(() => {
    setIsOpen(false);
  }, [pathname]);

  if (haveItems)
    return (
      <>
        <svg
          className={classes}
          onClick={handleClick}
          width="29"
          height="27"
          viewBox="0 0 31 27"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M7.54338 27C6.94577 27 6.4391 26.7987 6.02339 26.3961C5.60767 25.9935 5.39981 25.5043 5.39981 24.9286C5.39981 24.3529 5.6087 23.8648 6.02649 23.4643C6.44427 23.0637 6.95189 22.8635 7.54934 22.8635C8.14678 22.8635 8.65568 23.0648 9.07605 23.4674C9.4964 23.87 9.70658 24.3592 9.70658 24.9349C9.70658 25.5106 9.49635 25.9987 9.07588 26.3992C8.65542 26.7997 8.14459 27 7.54338 27ZM20.6603 27C20.0627 27 19.556 26.7987 19.1403 26.3961C18.7246 25.9935 18.5168 25.5043 18.5168 24.9286C18.5168 24.3529 18.7256 23.8648 19.1434 23.4643C19.5612 23.0637 20.0688 22.8635 20.6663 22.8635C21.2637 22.8635 21.7726 23.0648 22.193 23.4674C22.6133 23.87 22.8235 24.3592 22.8235 24.9349C22.8235 25.5106 22.6133 25.9987 22.1928 26.3992C21.7724 26.7997 21.2615 27 20.6603 27ZM5.53084 6.001L9.33173 13.5914H18.7658C18.8444 13.5914 18.9165 13.5725 18.982 13.5349C19.0476 13.4973 19.0978 13.445 19.1328 13.378L23.1695 6.35243C23.222 6.26039 23.2263 6.17881 23.1826 6.10767C23.1389 6.03656 23.0647 6.001 22.9598 6.001H5.53084ZM4.76544 4.57028H23.5419C24.0945 4.57028 24.509 4.80113 24.7853 5.26283C25.0615 5.72451 25.0712 6.18477 24.8143 6.6436L20.6669 13.8408C20.4471 14.1907 20.1575 14.4751 19.7981 14.6939C19.4387 14.9127 19.0588 15.0221 18.6584 15.0221H8.64232L6.74977 18.373C6.68859 18.4734 6.68859 18.5822 6.74977 18.6993C6.81092 18.8164 6.90704 18.875 7.03812 18.875H22.0883C22.2871 18.875 22.4593 18.9453 22.605 19.086C22.7507 19.2266 22.8235 19.393 22.8235 19.585C22.8235 19.7944 22.7507 19.9669 22.605 20.1024C22.4593 20.238 22.2871 20.3057 22.0883 20.3057H7.2953C6.44402 20.3057 5.83293 20.0268 5.46204 19.4688C5.09117 18.9108 5.09402 18.2988 5.47059 17.6327L7.66463 13.8177L2.53215 3.43069H0.758789C0.541901 3.43069 0.361214 3.36095 0.216729 3.22146C0.0722429 3.08196 0 2.91128 0 2.70942C0 2.50755 0.0722429 2.33885 0.216729 2.20332C0.361214 2.06777 0.541912 2 0.758823 2H2.91319C3.09987 2 3.2719 2.04466 3.42929 2.13398C3.5867 2.22328 3.69831 2.34637 3.76413 2.50326L4.76544 4.57028Z"
            fill="white"
          />
          <circle cx="25" cy="4" r="4" fill="#FBCBFB" />
        </svg>
        <SideCart
          isOpen={isOpen}
          handleClick={handleClick}
          cartData={cartData}
          cartDispatch={cartDispatch}
        />
      </>
    );

  return (
    <>
      <svg
        className={classes}
        onClick={handleClick}
        width="25"
        height="25"
        viewBox="0 0 31 27"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M7.54338 25C6.94577 25 6.4391 24.7987 6.02339 24.3961C5.60767 23.9935 5.39981 23.5043 5.39981 22.9286C5.39981 22.3529 5.6087 21.8648 6.02649 21.4643C6.44427 21.0637 6.95189 20.8635 7.54934 20.8635C8.14678 20.8635 8.65568 21.0648 9.07605 21.4674C9.4964 21.87 9.70658 22.3592 9.70658 22.9349C9.70658 23.5106 9.49635 23.9987 9.07588 24.3992C8.65542 24.7997 8.14459 25 7.54338 25ZM20.6603 25C20.0627 25 19.556 24.7987 19.1403 24.3961C18.7246 23.9935 18.5168 23.5043 18.5168 22.9286C18.5168 22.3529 18.7256 21.8648 19.1434 21.4643C19.5612 21.0637 20.0688 20.8635 20.6663 20.8635C21.2637 20.8635 21.7726 21.0648 22.193 21.4674C22.6133 21.87 22.8235 22.3592 22.8235 22.9349C22.8235 23.5106 22.6133 23.9987 22.1928 24.3992C21.7724 24.7997 21.2615 25 20.6603 25ZM5.53084 4.001L9.33173 11.5914H18.7658C18.8444 11.5914 18.9165 11.5725 18.982 11.5349C19.0476 11.4973 19.0978 11.445 19.1328 11.378L23.1695 4.35243C23.222 4.26039 23.2263 4.17881 23.1826 4.10767C23.1389 4.03656 23.0647 4.001 22.9598 4.001H5.53084ZM4.76544 2.57028H23.5419C24.0945 2.57028 24.509 2.80113 24.7853 3.26283C25.0615 3.72451 25.0712 4.18477 24.8143 4.6436L20.6669 11.8408C20.4471 12.1907 20.1575 12.4751 19.7981 12.6939C19.4387 12.9127 19.0588 13.0221 18.6584 13.0221H8.64232L6.74977 16.373C6.68859 16.4734 6.68859 16.5822 6.74977 16.6993C6.81092 16.8164 6.90704 16.875 7.03812 16.875H22.0883C22.2871 16.875 22.4593 16.9453 22.605 17.086C22.7507 17.2266 22.8235 17.393 22.8235 17.585C22.8235 17.7944 22.7507 17.9669 22.605 18.1024C22.4593 18.238 22.2871 18.3057 22.0883 18.3057H7.2953C6.44402 18.3057 5.83293 18.0268 5.46204 17.4688C5.09117 16.9108 5.09402 16.2988 5.47059 15.6327L7.66463 11.8177L2.53215 1.43069H0.758789C0.541901 1.43069 0.361214 1.36095 0.216729 1.22146C0.0722429 1.08196 0 0.911276 0 0.709423C0 0.507548 0.0722429 0.338848 0.216729 0.203322C0.361214 0.0677744 0.541912 0 0.758823 0H2.91319C3.09987 0 3.2719 0.044661 3.42929 0.133982C3.5867 0.223281 3.69831 0.346375 3.76413 0.503263L4.76544 2.57028Z"
          fill="white"
        />
      </svg>
      <SideCart
        isOpen={isOpen}
        handleClick={handleClick}
        cartData={cartData}
        cartDispatch={cartDispatch}
      />
    </>
  );
};

export { Cart };
